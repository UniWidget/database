const AUTHOR="青柠",QQ=3463448740,types={type:"BYPASS_JUST_CLICK_WIDGET",icon:"https://open.lihouse.xyz/static/omnia.svg",title:"一键绕审核",version:"1.0.0",auther:"青柠",docs:{url:"http://doc.lihouse.xyz/bypass_just_click.html"},platforms:["web","android","ios"],isInvisibleWidget:!0,isGlobalWidget:!0,hasAnyWidget:!1,properties:[],methods:[],events:[]};console.log(this.window);const processJsonData=async postData=>{try{let data=JSON.parse(JSON.stringify(postData));for(;data.unsafeExtensionWidgetList&&data.unsafeExtensionWidgetList.length>0;){const unsafeWidget=data.unsafeExtensionWidgetList.shift();let cdnUrl;try{cdnUrl=await qiniuCDN.uploadWidgetCode(unsafeWidget.code)}catch(e){console.log(`Failed to upload widget code: ${e}`),cdnUrl=`https://example.com/cdn/${unsafeWidget.type.replace("UNSAFE_","")}.jsx`,console.log(`Using mock URL: ${cdnUrl}`)}const newType=unsafeWidget.type.replace("UNSAFE_",""),newWidget={id:(data.extensionWidgetList?.length||0)+1e3,type:newType,cdnUrl:cdnUrl};if(data.extensionWidgetList||(data.extensionWidgetList=[]),data.extensionWidgetList.push(newWidget),data.screens)for(const[screenId,screen]of Object.entries(data.screens))if(screen.widgets){for(const[widgetId,widget]of Object.entries(screen.widgets))widget.type===unsafeWidget.type&&(widget.type=newType);screen.widgetIds&&(screen.widgetIds=screen.widgetIds.map((id=>id.replace(unsafeWidget.type,newType))))}}return JSON.stringify(data,null,2).replace(/UNSAFE_/g,"")}catch(error){throw console.error(`Error processing JSON: ${error}`),error}},qiniuCDN={generateFilePath:()=>`716/appcraft/JSON_${Math.random().toString(36).substring(2,10)}_omnia_${Date.now()}.json`,getUploadToken:async filePath=>{const url=`https://open-service.codemao.cn/cdn/qi-niu/tokens/uploading?${new URLSearchParams({projectName:"appcraft",filePaths:filePath,filePath:filePath,tokensCount:"1",fileSign:"p1",insertOnly:"true",cdnName:"qiniu"}).toString()}`;try{const response=await this.window["fetch"](url,{method:"GET",mode:"cors",credentials:"include",headers:{accept:"*/*","accept-language":"zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6","cache-control":"no-cache",pragma:"no-cache","sec-ch-ua":'"Microsoft Edge";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-site"},referrer:"https://coco.codemao.cn/",referrerPolicy:"strict-origin-when-cross-origin"});if(!response.ok)throw new Error(`获取上传凭证失败：${response.statusText}`);return await response.json()}catch(error){throw console.error("第一步：获取上传凭证出错：",error),error}},uploadFileToQiniu:async(jsonData,uploadInfo,filePath)=>{const jsonString=JSON.stringify(jsonData),blob=new Blob([jsonString],{type:"application/json;charset=utf-8"}),{token:token}=uploadInfo.tokens[0],uploadUrl=uploadInfo.upload_url,fileName=`omnia_${Date.now()}.json`,formData=new FormData;formData.append("file",blob,fileName),formData.append("token",token),formData.append("key",filePath),formData.append("fname",fileName);try{const response=await this.window["fetch"](uploadUrl,{method:"POST",mode:"cors",credentials:"omit",headers:{accept:"*/*","accept-language":"zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6","cache-control":"no-cache",pragma:"no-cache","sec-ch-ua":'"Microsoft Edge";v="137", "Chromium";v="137", "Not/A)Brand";v="24"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"},referrer:"https://coco.codemao.cn/",referrerPolicy:"strict-origin-when-cross-origin",body:formData});if(!response.ok)throw new Error(`文件上传失败：${response.statusText}`);return await response.json()}catch(error){throw console.error("第二步：文件上传出错：",error),error}},completeUpload:async jsonData=>{try{const filePath=qiniuCDN.generateFilePath();console.log("生成的文件路径：",filePath);const uploadInfo=await qiniuCDN.getUploadToken(filePath);console.log("获取到的上传凭证：",uploadInfo);const uploadResult=await qiniuCDN.uploadFileToQiniu(jsonData,uploadInfo,filePath);return console.log("文件上传成功，结果：",uploadResult),{...uploadResult,fileUrl:`${uploadInfo.bucket_url}${filePath}`}}catch(error){throw console.error("上传流程失败：",error),error}},uploadWidgetCode:async codeContent=>{const formData=new FormData,tempFileName=`widget_${Date.now()}.jsx`,blob=new Blob([codeContent],{type:"text/javascript"});formData.append("file",blob,tempFileName);const response=await this.window["fetch"]("https://open.lihouse.xyz/omnia/upload",{method:"POST",body:formData}),result=await response.json();if(result.data)return`https://open.lihouse.xyz/omnia/archieve/${result.data}`;throw new Error("Upload failed: "+JSON.stringify(result))}},targetMenu=this.window.document.querySelector(".Header_right__3m7KF .coco-dropdown.Header_shareMenu__wWtsL .coco-popover .coco-popover-content .coco-menu");if(targetMenu){const customData={imgUrl:"https://open.lihouse.xyz/static/omnia.svg",imgAlt:"bypass-right-now",text:"一键绕审核",onClick:async()=>{const workId=new URLSearchParams(this.window.location.search).get("workId");const postData=await async function(workId){try{const response=await this.window["fetch"]("https://coco.codemao.cn/editor/service/code?id=".concat(workId),{method:"GET",headers:{"Content-Type":"application/json"}});if(!response.ok)throw new Error(`HTTP错误！状态码：${response.status}`);return await response.json()}catch(error){throw this.window.omniaDialog.show("哎哟我去这个审核有点阴哈",error),error}}(workId);try{const processedJson=await processJsonData(postData);qiniuCDN.completeUpload(JSON.parse(processedJson)).then((result=>{this.window.omniaDialog.show("审核直接给我坐下","https://open.lihouse.xyz/omnia/player/bcmc/"+result.fileUrl.split("/").pop())})).catch((error=>{this.window.omniaDialog.show("哎哟我去这个审核有点阴哈",error)}))}catch(error){this.window.omniaDialog.show("哎哟我去这个审核有点阴哈",error)}}},newMenuItem=this.window.document.createElement("div");newMenuItem.className="coco-menu-item",newMenuItem.innerHTML=`\n        <div>\n            <div class="style_shareBtn__2X5i-">\n                <img \n                    src="${customData.imgUrl}" \n                    alt="${customData.imgAlt}" \n                    class="style_shareIcon__edD64"\n                >\n                <span class="style_shareMessage__3hXpU">${customData.text}</span>\n            </div>\n        </div>\n    `,newMenuItem.addEventListener("click",customData.onClick),this.window.document.querySelectorAll(".style_shareBtn__2X5i-").length<=2&&targetMenu.appendChild(newMenuItem)}else console.error("未找到目标coco-menu，请检查DOM结构");!function(){let currentTitle="";function ensureOmniaDialogExists(){let dialog=this.window.document.querySelector(".networkError_networkDialog__17FC2");if(!dialog){dialog=function(){const dialog=this.window.document.createElement("div");return dialog.setAttribute("data-html2canvas-ignore","true"),dialog.setAttribute("tabindex","-1"),dialog.className="coco-dialog networkError_networkDialog__17FC2",dialog.innerHTML=`\n                <div class="coco-dialog-mask hidden"></div>\n                <div class="coco-dialog-scroll">\n                    <div class="coco-dialog-wrapper hidden">\n                        <div class=""></div>\n                        <div class="coco-dialog-content">\n                            <div class="networkError_networkContent__1GH32" style="-webkit-user-select: text;-ms-user-select: text;user-select: text;">\n                                <img src="https://creation.codemao.cn/coconut/web/1.22.0-0/static/media/networkError.3103f5bb.png" alt="OMNIA HACK">\n                                <div class="networkError_networkText__3Oikh">\n                                    <h3 id="current-title">${currentTitle||"出现问题"}</h3>\n                                    <ul>\n                                       \n                                        <li><span>返回：<span id="current-callback">请检查代码</span></span></li>\n                                        <li><span>说明：使用本功能首先需保存作品，如果还失败那么请先点击运行再尝试</span></li>\n                                        <li><span>支持：为OMNIA系列服务，由calyxor精心制作</span></li>\n\n                                    </ul>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="coco-dialog-footer">\n                            <div style="display: flex;justify-content: space-between;align-items: center;margin: 0 auto;">\n                                <button class="coco-button coco-button-circle">确认</button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            `,dialog.querySelector(".coco-button").addEventListener("click",(function(){hideOmniaDialog()})),dialog.querySelector(".coco-dialog-mask").addEventListener("click",(function(){hideOmniaDialog()})),dialog}();const header=this.window.document.querySelector(".Header_wrapper__3tGRg");if(!header)return console.error("未找到.Header_wrapper__3tGRg元素"),null;header.appendChild(dialog)}return dialog}function hideOmniaDialog(){const dialog=this.window.document.querySelector(".networkError_networkDialog__17FC2");if(dialog){const wrapper=dialog.querySelector(".coco-dialog-wrapper"),mask=dialog.querySelector(".coco-dialog-mask");wrapper&&mask&&(wrapper.classList.add("hidden"),mask.classList.add("hidden"),dialog.style.display="none")}}this.window.omniaDialog={show:function(title,callback){const dialog=ensureOmniaDialogExists();if(!dialog)return;if(callback&&title){currentCallback=callback,currentTitle=title;const callbackElement=dialog.querySelector("#current-callback");callbackElement&&(callbackElement.textContent=currentCallback);const titleElement=dialog.querySelector("#current-title");titleElement&&(titleElement.textContent=currentTitle)}const wrapper=dialog.querySelector(".coco-dialog-wrapper"),mask=dialog.querySelector(".coco-dialog-mask");wrapper&&mask&&(wrapper.classList.remove("hidden"),mask.classList.remove("hidden"),dialog.style.display="")},hide:hideOmniaDialog}}();class Widget extends InvisibleWidget{constructor(props){super(props),console.log("[BYPASS_JUST_CLICK] 作者:青柠 联系方式:"+QQ)}}exports.types=types,exports.widget=Widget;